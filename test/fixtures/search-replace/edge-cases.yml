apply_diff_tests:
  - name: strip-line-numbers
    description: Should strip leading line numbers from search and replace blocks
    input:
      original_content: "    return true;"
      diff_content: |
        test.ts
        <<<<<<< SEARCH
        2 |     return true;
        =======
        2 |     return false; // A comment
        >>>>>>> REPLACE
    expected:
      success: true
      content: "    return false; // A comment"
  - name: first-of-ambiguous-match-is-replaced
    description: Should replace the first occurrence of an ambiguous match when no line numbers are given
    input:
      original_content: |
        config.set("value", 1);
        // ... lots of code
        config.set("value", 1);
      diff_content: |
        test.ts
        <<<<<<< SEARCH
        config.set("value", 1);
        =======
        config.set("value", 2);
        >>>>>>> REPLACE
    expected:
      success: true
      content: |
        config.set("value", 2);
        // ... lots of code
        config.set("value", 1);
  - name: replace-at-start-of-file
    description: Should correctly replace content at the very beginning of the file
    input:
      original_content: |
        // Header
        function start() {}
      diff_content: |
        test.ts
        <<<<<<< SEARCH
        // Header
        =======
        // New Header
        >>>>>>> REPLACE
    expected:
      success: true
      content: |
        // New Header
        function start() {}
  - name: replace-at-end-of-file
    description: Should correctly replace content at the very end of the file
    input:
      original_content: |
        function start() {}
        // Footer
      diff_content: |
        test.ts
        <<<<<<< SEARCH
        // Footer
        =======
        // New Footer
        >>>>>>> REPLACE
    expected:
      success: true
      content: |
        function start() {}
        // New Footer
  - name: replace-block-with-trailing-newline
    description: Should correctly handle a replace block that ends with a newline
    input:
      original_content: |
        const x = 1;
      diff_content: |
        test.ts
        <<<<<<< SEARCH
        const x = 1;
        =======
        const y = 2;

        >>>>>>> REPLACE
    expected:
      success: true
      content: |
        const y = 2;

  - name: remove-extra-blank-lines
    description: Should be able to search for and remove only whitespace
    input:
      original_content: |
        line 1


        line 2
      diff_content: |
        test.ts
        <<<<<<< SEARCH

        =======
        >>>>>>> REPLACE
    expected:
      success: true
      content: |
        line 1

        line 2
  - name: unicode-characters-replace
    description: Should correctly handle files with unicode characters in search and replace
    input:
      original_content: "const greeting = '你好世界';"
      diff_content: |
        test.ts
        <<<<<<< SEARCH
        const greeting = '你好世界';
        =======
        const greeting = 'こんにちは世界';
        >>>>>>> REPLACE
    expected:
      success: true
      content: "const greeting = 'こんにちは世界';"